<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />

		<link rel="stylesheet" href="jquery.ui.all.css">
		<script src="jquery-1.7.2.js"></script>
		<script src="jquery.ui.core.js"></script>
		<script src="jquery.ui.widget.js"></script>
		<script src="jquery.ui.mouse.js"></script>
		<script src="jquery.ui.slider.js"></script>
		<link rel="stylesheet" href="demos.css">
		<style>			
			#heatmapArea {
				width:1024px;
				height:768px;
				background-color: black;
				margin:0;
			}
			html{
				padding:0;
				margin:0;
			}

		</style>
		<script type="text/javascript" src="heatmap.js"></script>
	</head>
	<body>
		<div id="main">
			<div id="heatmapArea">
			
			</div>

			<div id="slider-range"></div>

			<h1 id="msg">
				<p id="date"></p>
				<p id="coordinate"></p>
			</h1>
			
		</div>
		
		<script>
		var data = 
			{"February 2012":{"1024 x 480":2,"1024 x 600":129,"1024 x 768":101,"1024 x 800":9,"1152 x 600":97,"1152 x 768":18,"1152 x 864":18,"1280 x 1024":69,"1280 x 768":868,"1280 x 800":1491,"1280 x 864":3,"1400 x 864":50,"1600 x 1050":10,"1600 x 800":14,"1600 x 864":18,"1920 x 1024":3,"1920 x 1050":26,"600 x 800":1,"640 x 480":4,"800 x 480":21,"800 x 600":18},"February 2011":{"1024 x 600":33,"1024 x 768":60,"1152 x 600":8,"1152 x 768":9,"1152 x 864":5,"1280 x 1024":25,"1280 x 600":7,"1280 x 768":175,"1280 x 800":575,"1280 x 864":1,"1400 x 864":9,"1600 x 1050":4,"1600 x 864":6,"1920 x 1024":1,"1920 x 1050":5,"800 x 480":2,"800 x 600":10},"October 2011":{"1024 x 1536":1,"1024 x 480":1,"1024 x 600":473,"1024 x 768":596,"1024 x 800":8,"1152 x 600":92,"1152 x 768":24,"1152 x 864":45,"1280 x 1024":329,"1280 x 768":2099,"1280 x 800":2262,"1280 x 864":7,"1400 x 864":193,"1600 x 1024":8,"1600 x 1050":26,"1600 x 1200":1,"1600 x 800":44,"1600 x 864":103,"1920 x 1024":1,"1920 x 1050":31,"1920 x 1200":4,"2560 x 1024":1,"640 x 480":4,"800 x 480":4,"800 x 600":111},"September 2011":{"1024 x 600":439,"1024 x 768":586,"1024 x 800":6,"1024 x 864":1,"1152 x 600":61,"1152 x 768":2,"1152 x 864":41,"1280 x 1024":371,"1280 x 768":1356,"1280 x 800":1051,"1400 x 864":178,"1600 x 1024":9,"1600 x 1050":70,"1600 x 1200":1,"1600 x 800":29,"1600 x 864":45,"1920 x 1024":1,"1920 x 1050":25,"640 x 480":1,"800 x 480":3,"800 x 600":133},"August 2011":{"1024 x 600":374,"1024 x 768":385,"1024 x 800":10,"1152 x 600":16,"1152 x 864":31,"1280 x 1024":278,"1280 x 600":3,"1280 x 768":811,"1280 x 800":532,"1400 x 864":148,"1600 x 1050":11,"1600 x 1200":1,"1600 x 800":7,"1600 x 864":71,"1920 x 1024":4,"1920 x 1050":16,"2560 x 768":1,"640 x 480":2,"800 x 480":2,"800 x 600":326},"January 2011":{"1024 x 600":22},"March 2011":{"1024 x 1280":1,"1024 x 600":455,"1024 x 768":1070,"1024 x 800":8,"1024 x 864":3,"1152 x 600":52,"1152 x 768":15,"1152 x 864":15,"1280 x 1024":236,"1280 x 600":26,"1280 x 768":1380,"1280 x 800":2876,"1280 x 864":1,"1400 x 1050":2,"1400 x 864":84,"1600 x 1024":2,"1600 x 1050":6,"1600 x 1200":1,"1600 x 800":5,"1600 x 864":41,"1920 x 1024":4,"1920 x 1050":3,"800 x 480":33,"800 x 600":50},"March 2012":{"1024 x 600":448,"1024 x 768":369,"1024 x 800":20,"1152 x 600":79,"1152 x 768":22,"1152 x 800":2,"1152 x 864":46,"1280 x 1024":94,"1280 x 600":15,"1280 x 768":1696,"1280 x 800":1853,"1280 x 864":9,"1400 x 864":159,"1600 x 1024":4,"1600 x 1050":16,"1600 x 800":13,"1600 x 864":90,"1920 x 1050":57,"2560 x 1024":2,"768 x 400":1,"800 x 480":8,"800 x 600":333},"July 2011":{"1024 x 600":151,"1024 x 768":261,"1152 x 600":52,"1152 x 768":3,"1152 x 864":17,"1280 x 1024":49,"1280 x 768":470,"1280 x 800":454,"1400 x 864":87,"1600 x 1050":3,"1600 x 800":1,"1600 x 864":12,"1920 x 1050":17,"800 x 600":48},"May 2011":{"1024 x 600":606,"1024 x 768":1126,"1024 x 800":16,"1152 x 600":95,"1152 x 768":24,"1152 x 864":62,"1280 x 1024":419,"1280 x 768":2407,"1280 x 800":3869,"1280 x 864":2,"1400 x 1050":1,"1400 x 864":339,"1600 x 1050":50,"1600 x 800":17,"1600 x 864":94,"1920 x 1024":1,"1920 x 1050":31,"2560 x 864":1,"320 x 240":1,"640 x 400":1,"800 x 480":38,"800 x 600":158},"May 2012":{"1024 x 480":1,"1024 x 600":1017,"1024 x 768":777,"1024 x 800":8,"1152 x 600":177,"1152 x 768":13,"1152 x 864":48,"1280 x 1024":228,"1280 x 600":11,"1280 x 768":3823,"1280 x 800":2713,"1280 x 864":6,"1400 x 1200":2,"1400 x 864":280,"1600 x 1024":9,"1600 x 1050":49,"1600 x 1200":4,"1600 x 1280":2,"1600 x 800":28,"1600 x 864":165,"1920 x 1024":2,"1920 x 1050":52,"1920 x 1200":1,"2048 x 1200":1,"600 x 400":1,"768 x 400":3,"768 x 480":1,"800 x 480":25,"800 x 600":217},"January 2012":{"1024 x 480":1,"1024 x 600":97,"1024 x 768":274,"1024 x 800":4,"1152 x 600":35,"1152 x 768":3,"1152 x 864":10,"1280 x 1024":106,"1280 x 768":674,"1280 x 800":1094,"1280 x 864":2,"1400 x 864":28,"1600 x 1024":7,"1600 x 1050":12,"1600 x 800":10,"1600 x 864":32,"1920 x 1024":2,"1920 x 1050":12,"800 x 480":7,"800 x 600":16},"April 2012":{"1024 x 600":943,"1024 x 768":608,"1024 x 800":13,"1152 x 600":105,"1152 x 768":14,"1152 x 800":4,"1152 x 864":53,"1280 x 1024":175,"1280 x 600":19,"1280 x 768":2834,"1280 x 800":1881,"1280 x 864":14,"1400 x 1200":3,"1400 x 864":216,"1600 x 1024":9,"1600 x 1050":34,"1600 x 800":41,"1600 x 864":186,"1920 x 1050":44,"1920 x 1200":3,"600 x 400":1,"640 x 480":1,"800 x 480":36,"800 x 600":223},"June 2011":{"1024 x 1280":1,"1024 x 600":435,"1024 x 768":806,"1024 x 800":10,"1152 x 600":78,"1152 x 768":13,"1152 x 864":40,"1280 x 1024":170,"1280 x 600":1,"1280 x 768":1665,"1280 x 800":2419,"1280 x 864":14,"1400 x 1050":1,"1400 x 864":245,"1600 x 1024":1,"1600 x 1050":30,"1600 x 1200":3,"1600 x 800":44,"1600 x 864":70,"1920 x 1050":20,"768 x 480":15,"800 x 1280":1,"800 x 480":71,"800 x 600":83},"January 2011":{"1024 x 768":50,"1024 x 800":1,"1152 x 600":7,"1152 x 768":2,"1152 x 864":2,"1280 x 1024":35,"1280 x 600":4,"1280 x 768":132,"1280 x 800":383,"1400 x 864":1,"1600 x 1024":1,"1600 x 1050":6,"1600 x 800":3,"1600 x 864":1,"1920 x 1050":3,"800 x 480":2,"800 x 600":25},"November 2011":{"1024 x 1280":1,"1024 x 480":1,"1024 x 600":652,"1024 x 768":657,"1024 x 800":14,"1152 x 600":167,"1152 x 768":12,"1152 x 864":50,"1280 x 1024":204,"1280 x 600":7,"1280 x 768":2808,"1280 x 800":4288,"1280 x 864":6,"1400 x 864":221,"1600 x 1024":8,"1600 x 1050":35,"1600 x 800":94,"1600 x 864":115,"1920 x 1024":7,"1920 x 1050":28,"1920 x 1200":3,"2048 x 1200":1,"640 x 480":2,"800 x 1280":1,"800 x 480":23,"800 x 600":119},"December 2011":{"1024 x 480":3,"1024 x 600":365,"1024 x 768":422,"1024 x 800":8,"1152 x 600":166,"1152 x 768":7,"1152 x 864":19,"1280 x 1024":176,"1280 x 600":1,"1280 x 768":2196,"1280 x 800":3183,"1280 x 864":7,"1400 x 1200":1,"1400 x 864":100,"1600 x 1024":11,"1600 x 1050":30,"1600 x 800":30,"1600 x 864":47,"1920 x 1024":12,"1920 x 1050":26,"1920 x 1200":5,"640 x 400":2,"640 x 480":1,"768 x 1024":1,"800 x 480":11,"800 x 600":60},"April 2011":{"1024 x 1280":1,"1024 x 600":926,"1024 x 768":1360,"1024 x 800":13,"1152 x 600":101,"1152 x 768":26,"1152 x 864":43,"1280 x 1024":547,"1280 x 600":14,"1280 x 768":2560,"1280 x 800":3706,"1280 x 864":5,"1400 x 1050":14,"1400 x 864":329,"1600 x 1024":2,"1600 x 1050":35,"1600 x 800":16,"1600 x 864":122,"1920 x 1024":2,"1920 x 1050":18,"2048 x 1200":1,"640 x 400":10,"640 x 480":1,"768 x 600":1,"800 x 480":27,"800 x 600":165},"June 2012":{"1024 x 600":700,"1024 x 768":472,"1024 x 800":3,"1152 x 600":80,"1152 x 768":15,"1152 x 864":25,"1280 x 1024":117,"1280 x 600":7,"1280 x 768":2645,"1280 x 800":752,"1280 x 864":5,"1400 x 1200":3,"1400 x 864":250,"1600 x 1024":5,"1600 x 1050":30,"1600 x 1200":2,"1600 x 1280":1,"1600 x 800":19,"1600 x 864":123,"1920 x 1024":2,"1920 x 1050":16,"1920 x 1200":1,"2048 x 1200":1,"800 x 480":9,"800 x 600":104}}
		
		var dates = [];
		for(var date in data){
			dates.push(date);			
		}		

		function accumelate(from, to){
			for(var fp in from){
				if(fp in to) {
					to[fp] += from[fp]; 
				}else{
					to[fp] = from[fp];
				}
			}
		}
		
		dates.sort(function(d1,d2){return new Date(d1) - new Date(d2)});

		for(var i=0, l = dates.length; i < l-1; i++){
			accumelate(data[dates[i]], data[dates[i+1]]);
		}		
		</script>	

		<script type="text/javascript">
		var WIDTH = 1024, HEIGHT = 768, widthRatio = HEIGHT / 1280, heightRatio = WIDTH / 2560;

		window.onload = function(){
			var heatmap = heatmapFactory.create({
				"element":document.getElementById("heatmapArea"), 
				"radius":20, 
				"visible":true});
			
			$( "#slider-range" ).slider({
				range: true,
				min: 0,
				max: dates.length-1,
				values: [ 0, dates.length-1 ],
				slide: function( event, ui ) {
					var from = ui.values[0], to = ui.values[1];
					var data = getHeatData(from, to);
					heatmap.store.setDataSet(data);
					$('#date').html(dates[from] + " - " + dates[to]);
				}
			});

			$('#heatmapArea canvas').mousemove(function(evt){
				var w = parseInt(evt.offsetX / widthRatio),
					h = parseInt((HEIGHT - evt.offsetY) / heightRatio);

				$('#coordinate').html(w + " x " + h);
			});
		};
		
		function getHeatData(startIndex/*inclusive*/, endIndex/*inclusive*/) {
			var start = startIndex == 0 ? {} : data[dates[startIndex - 1]], end = data[dates[endIndex]], count;
			var result = [];
			var max = 0;
			for(var p in end){
				if(p in start){
					count = end[p] - start[p];
				}else{
					count = end[p];
				}
				var xy = p.split('x');
				count = Math.log(1+count);
				result.push( {x: widthRatio * parseInt(xy[0]), y: HEIGHT - heightRatio * parseInt(xy[1]), count: count});	
				if(count > max)
					max = count;				
			}

			return {max:max, data:result};
		}
		</script>
	</body>
</html>